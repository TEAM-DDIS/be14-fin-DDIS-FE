<template>
  <h1 class="page-title">
    <img
      src="@/assets/icons/back_btn.svg"
      alt="back"
      class="back-btn"
      @click="goBack"
    />
    ÏÇ¨Ïõê Î™©Î°ù Ï°∞Ìöå
  </h1>
  <div class="desc-row">
    <p class="desc">ÏÇ¨Ïõê ÏÉÅÏÑ∏ Ï°∞Ìöå </p>
  </div>

  <div class="employee-detail" :class="{ 'editing-mode': isEditing }">
    <div class="card compact-card adjusted-card short-height-card overflow-scroll-wrapper top-card">
      <div class="top-card-layout">
        <!-- ÌîÑÎ°úÌïÑ -->
        <div class="profile-area">
          <div class="profile-wrapper">
            <!-- Ïã§Ï†ú Ïù¥ÎØ∏ÏßÄ(ÎòêÎäî placeholder)Î•º ÌÅ¥Î¶≠ Í∞ÄÎä•ÌïòÍ≤å -->
            <img
              v-if="previewSrc"
              :src="previewSrc"
              class="profile-img"
              :class="{ editable: isEditing }"
              @click="triggerFileSelect"
            />
            <div
              v-else
              class="profile-placeholder-box editable"
              @click="triggerFileSelect"
            >
              <span>ÏÇ¨ÏßÑ ÏóÜÏùå</span>
            </div>

            <!-- ÏàòÏ†ï Î™®ÎìúÏùº ÎïåÎßå Î≥¥Ïù¥Îäî ÏóÖÎ°úÎìú ÏïÑÏù¥ÏΩò -->
            <button
              v-if="isEditing"
              class="upload-btn-icon"
              type="button"
              @click="triggerFileSelect"
            >
              <img
                src="@/assets/icons/img_btn.svg"
                alt="Upload"
                class="upload-icon"
              />
            </button>

            <!-- Ïà®Í≤®ÏßÑ ÌååÏùº ÏûÖÎ†•Ï∞Ω -->
            <input
              ref="fileInput"
              type="file"
              accept="image/*"
              style="display: none"
              @change="onPhotoSelected"
            />
          </div>
        </div>
        <!-- Ìèº Í∑∏Î¶¨Îìú -->
        <div class="top-grid-info">
          <div class="info-item">
            <label class="label-bold">ÏÇ¨ÏõêÎ™Ö
              <span class="required-star">*</span>
            </label>  
            <input
              class="same-size-input"
              v-model="form.employeeName"
              :readonly="!isEditing"
            />
          </div>
          <!-- ÏßÅÎ¨¥ -->
          <div class="info-item">
            <label class="label-bold">ÏßÅÎ¨¥</label>
            <input
              class="same-size-input"
              :value="form.jobName || '-'"
              readonly
            />
          </div>
          <div class="info-item">
            <label class="label-bold">Í∑ºÎ¨¥ÌòïÌÉú
              <span class="required-star">*</span>
            </label>
            <!-- ÏàòÏ†ï Î™®ÎìúÏùº ÎïåÎßå ÎìúÎ°≠Îã§Ïö¥ -->
            <template v-if="isEditing">
              <select v-model="form.workType" class="same-size-input">
                <option value="">ÏÑ†ÌÉù</option>
                <option
                  v-for="opt in workTypeOptions"
                  :key="opt"
                  :value="opt"
                >
                  {{ opt }}
                </option>
              </select>
            </template>
            <!-- Î≥¥Í∏∞ Î™®ÎìúÏùº ÎïåÎäî ÏùΩÍ∏∞ Ï†ÑÏö© ÌÖçÏä§Ìä∏ -->
            <template v-else>
              <input
                class="same-size-input"
                :value="form.workType || '-'"
                readonly
              />
            </template>
          </div>
          <!-- Î≥∏Î∂Ä -->
          <div class="info-item">
            <label class="label-bold">Î≥∏Î∂Ä</label>
            <input
              class="same-size-input"
              :value="form.headName || '-'"
              readonly
            />
          </div>
          <!-- ÏßÅÏ±Ö -->
          <div class="info-item">
            <label class="label-bold">ÏßÅÏ±Ö</label>
            <input
              class="same-size-input"
              :value="form.positionName || '-'"
              readonly
            />
          </div>
          <div class="info-item">
            <label class="label-bold">ÏûÖÏÇ¨Ïùº
              <span class="required-star">*</span> 
            </label>
            <input type="date" class="same-size-input" v-model="form.employmentDate" :readonly="!isEditing" />
          </div>
          <!-- Î∂ÄÏÑú -->
          <div class="info-item">
            <label class="label-bold">Î∂ÄÏÑú</label>
            <input
              class="same-size-input"
              :value="form.departmentName || '-'"
              readonly
            />
          </div>
          <!-- ÏßÅÍ∏â -->
          <div class="info-item">
            <label class="label-bold">ÏßÅÍ∏â</label>
            <input
              class="same-size-input"
              :value="form.rankName || '-'"
              readonly
            />
          </div>
          <div class="info-item">
            <label class="label-bold">Ìá¥ÏÇ¨Ïùº</label>
            <input type="date" class="same-size-input" v-model="form.retirementDate" :readonly="!isEditing" />
          </div>
          <!-- ÌåÄ -->
          <div class="info-item">
            <label class="label-bold">ÌåÄ</label>
            <input
              class="same-size-input"
              :value="form.teamName || '-'"
              readonly
            />
          </div>
          <div class="info-item">
            <label class="label-bold">Ïó∞ÎùΩÏ≤ò
              <span class="required-star">*</span> 
            </label>
            <input class="same-size-input" v-model="form.employeeContact" :readonly="!isEditing" />
            <span v-if="isEditing && errors.contact" class="error-text">{{ errors.contact }}</span>
          </div>
          <div class="info-item"></div>
          <div class="info-item">
            <label class="label-bold">ÏÇ¨Î≤à
              <span class="required-star">*</span> 
            </label>
            <input class="same-size-input" v-model="form.employeeId" :readonly />
          </div>
          <div class="info-item">
            <label class="label-bold">Ïù¥Î©îÏùº
              <span class="required-star">*</span> 
            </label>
            <input class="same-size-input" v-model="form.employeeEmail" :readonly="!isEditing"/>
            <span v-if="isEditing && errors.email" class="error-text">{{ errors.email }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- HR Í∂åÌïúÏù¥ ÏûàÏùÑ ÎïåÎßå ÌÉ≠ Î∞è ÌïòÎã® Ïª®ÌÖêÏ∏† Î≥¥Ïó¨Ï£ºÍ∏∞ -->
    <template v-if="isHR">
      <!-- üî∑ Í≤πÏ≥êÏßÄÎäî ÌÉ≠ Ïä§ÌÉÄÏùº Ï†ÅÏö© -->
      <div class="tab-wrapper">
        <div class="tab-menu">
          <button
            v-for="tab in tabs"
            :key="tab"
            :class="{ active: currentTab === tab }"
            @click="currentTab = tab"
          >
            {{ tab }}
          </button>
        </div>
      </div>

      <!-- ÌïòÎã® Ïπ¥Îìú: ÌÉ≠Î≥Ñ ÏùΩÍ∏∞ Ï†ÑÏö© ÌïÑÎìú -->
      <div class="card tab-content overflow-scroll-wrapper bottom-card">
        <div class="tab-content-wrapper">
          <!-- Ïù∏ÏÇ¨Ï†ïÎ≥¥ -->
          <div v-if="currentTab === 'Ïù∏ÏÇ¨Ï†ïÎ≥¥'">
            <div class="grid-info scrollable-grid">
              <div class="info-column">
                <div class="info-item">
                  <label class="label-bold">
                    ÏÑ±Î≥Ñ
                    <span class="required-star">*</span>
                  </label>
                  <!-- ÏàòÏ†ï Î™®ÎìúÏùº Îïå ÎìúÎ°≠Îã§Ïö¥ -->
                  <template v-if="isEditing">
                    <select v-model="form.employeeGender" class="same-size-input">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="g in genderOptions"
                        :key="g"
                        :value="g"
                      >
                        {{ g }}
                      </option>
                    </select>
                  </template>
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.employeeGender || '-'"
                      readonly
                    />
                  </template>
                </div>
                <div class="info-item">
                  <label class="label-bold">Í±∞Îûò ÏùÄÌñâ
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.bankName" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">
                    4ÎåÄ Î≥¥Ìóò
                    <span class="required-star">*</span>
                  </label>
                  <template v-if="isEditing">
                    <select v-model="form.isFourInsurances" class="same-size-input">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="opt in insuranceOptions"
                        :key="opt"
                        :value="opt"
                      >
                        {{ opt }}
                      </option>
                    </select>
                  </template>
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.isFourInsurances || '-'"
                      readonly
                    />
                  </template>
                </div>
                <div class="info-item">
                  <label class="label-bold">ÏÉùÎÖÑÏõîÏùº
                    <span class="required-star">*</span> 
                  </label>
                  <input type="date" class="same-size-input" v-model="form.employeeBirth" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">Í≥ÑÏ¢å Î≤àÌò∏
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.bankAccount" :readonly="!isEditing" />
                  <span v-if="isEditing && errors.bankAccount" class="error-text">{{ errors.bankAccount }}</span>
                </div>
                <div class="info-item"></div>
                <div class="info-item">
                  <label class="label-bold">Íµ≠Ï†Å
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.employeeNation" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">ÏòàÍ∏àÏ£º
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.bankDepositor" :readonly="!isEditing" />
                </div>
              </div>
            </div>
          </div>
          <!-- Í∞úÏù∏Ï†ïÎ≥¥ -->
          <div v-else-if="currentTab === 'Í∞úÏù∏Ï†ïÎ≥¥'">
            <div class="grid-info scrollable-grid">
              <div class="info-column">
                <div class="info-item">
                  <label class="label-bold">Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.employeeResident" :readonly="!isEditing" />
                  <span v-if="isEditing && errors.resident" class="error-text">{{ errors.resident }}</span>
                </div>
                <div class="info-item">
                  <label class="label-bold">
                    Ï°∏ÏóÖÎÖÑÎèÑ
                  </label>
                  <!-- ÏàòÏ†ï Î™®ÎìúÏùº Îïå ÎìúÎ°≠Îã§Ïö¥ -->
                  <template v-if="isEditing">
                    <select class="same-size-input" v-model="form.graduationYear">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="year in yearOptions"
                        :key="year"
                        :value="year"
                      >
                        {{ year }}
                      </option>
                    </select>
                  </template>
                  <!-- Î≥¥Í∏∞ Î™®ÎìúÏùº Îïå ÏùΩÍ∏∞ Ï†ÑÏö© ÌÖçÏä§Ìä∏ -->
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.graduationYear || '-'" 
                      readonly
                    />
                  </template>
                </div>
                <div class="info-item">
                  <label class="label-bold">
                    Í≤∞Ìòº Ïó¨Î∂Ä
                    <span class="required-star">*</span>
                  </label>
                  <template v-if="isEditing">
                    <select v-model="form.isMarriage" class="same-size-input">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="opt in marriageOptions"
                        :key="opt"
                        :value="opt"
                      >
                        {{ opt }}
                      </option>
                    </select>
                  </template>
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.isMarriage || '-'"
                      readonly
                    />
                  </template>
                </div>
                <div class="info-item">
                  <label class="label-bold">Ï£ºÏÜå
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.employeeAddress" :readonly="!isEditing"/>
                </div>
                <div class="info-item">
                  <label class="label-bold">Í≤ΩÎ†• ÎÖÑÏàò</label>
                  <input type="number" class="same-size-input" v-model="form.careerYearCount" :readonly="!isEditing"/>
                </div>
                <div class="info-item">
                  <label class="label-bold">Í≤∞Ìòº ÏùºÏûê</label>
                  <input type="date" class="same-size-input" v-model="form.marriageDate" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">ÏµúÏ¢Ö ÌïôÎ†•
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.finalAcademic" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">Ïù¥Ï†Ñ Í∑ºÎ¨¥ ÌöåÏÇ¨</label>
                  <input class="same-size-input" v-model="form.previousCompany" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">Î∂ÄÏñë Í∞ÄÏ°± Ïàò
                    <span class="required-star">*</span> 
                  </label>
                  <input type="number" class="same-size-input" v-model="form.familyCount" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">Ï∂úÏã†ÌïôÍµê
                    <span class="required-star">*</span> 
                  </label>
                  <input class="same-size-input" v-model="form.employeeSchool" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">
                    Ïû•Ïï† Ïó¨Î∂Ä
                    <span class="required-star">*</span>
                  </label>
                  <template v-if="isEditing">
                    <select v-model="form.isDisorder" class="same-size-input">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="opt in disorderOptions"
                        :key="opt"
                        :value="opt"
                      >
                        {{ opt }}
                      </option>
                    </select>
                  </template>
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.isDisorder || '-'"
                      readonly
                    />
                  </template>
                </div>
                <div class="info-item"></div>
                <div class="info-item">
                  <label class="label-bold">Ï†ÑÍ≥µ</label>
                  <input class="same-size-input" v-model="form.employeeDept" :readonly="!isEditing" />
                </div>
                <div class="info-item">
                  <label class="label-bold">
                    Î≥ëÏó≠ Ïó¨Î∂Ä
                    <span class="required-star">*</span>
                  </label>
                  <template v-if="isEditing">
                    <select v-model="form.militaryType" class="same-size-input">
                      <option value="">ÏÑ†ÌÉù</option>
                      <option
                        v-for="m in militaryOptions"
                        :key="m"
                        :value="m"
                      >
                        {{ m }}
                      </option>
                    </select>
                  </template>
                  <!-- Î≥¥Í∏∞ Î™®ÎìúÏùº Îïå ÏùΩÍ∏∞ Ï†ÑÏö© ÌÖçÏä§Ìä∏ -->
                  <template v-else>
                    <input
                      class="same-size-input"
                      :value="form.militaryType || '-'"
                      readonly
                    />
                  </template>
                </div>
              </div>
            </div>
          </div>
          <!-- Ïù∏ÏÇ¨Î∞úÎ†π ÌÉ≠: AG Grid -->
          <div v-else-if="currentTab === 'Ïù∏ÏÇ¨Î∞úÎ†π'">
            <div class="ag-theme-alpine ag-grid-box custom-theme">
              <BaseGrid
                :columnDefs="appointmentColumnDefs"
                :gridOptions="{ theme: 'legacy' }"
                :rowData="appointmentData"
                :defaultColDef="defaultColDef"
                :pagination="true"
                :paginationPageSize="pageSize"
                rowSelection="multiple"
                @grid-ready="onGridReady"
                @cell-click="onCellClick"
                style="width:100%; height:100%"
              />
            </div>
          </div>
          <!-- ÏßïÍ≥Ñ ÌÉ≠: AG Grid -->
          <div v-else-if="currentTab === 'ÏßïÍ≥Ñ'">
            <div class="ag-theme-alpine ag-grid-box custom-theme">
              <BaseGrid
                :columnDefs="disciplineColumnDefs"
                :gridOptions="{ theme: 'legacy' }"
                :rowData="disciplineData"
                :defaultColDef="defaultColDef"
                :pagination="true"
                :paginationPageSize="pageSize"
                rowSelection="multiple"
                @grid-ready="onGridReady"
                @cell-click="onCellClick"
                style="width:100%; height:100%"
              />
            </div>
          </div>
          <!-- Í≥ÑÏïΩ ÌÉ≠: AG Grid -->
          <div v-else-if="currentTab === 'Í≥ÑÏïΩ'">
            <div class="ag-theme-alpine ag-grid-box custom-theme">
              <BaseGrid
                :columnDefs="contractColumnDefs"
                :gridOptions="{ theme: 'legacy' }"
                :rowData="contractData"
                :defaultColDef="defaultColDef"
                :pagination="true"
                :paginationPageSize="pageSize"
                rowSelection="multiple"
                @grid-ready="onGridReady"
                @cell-clicked="onCellClick"
                style="width:100%; height:100%"
              />
            </div>
          </div>
        </div>
        
        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ÌïòÎã® Í≥†Ï†ï Î≤ÑÌäº ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="action-buttons-bottom">
          <!-- Î≥¥Í∏∞ Î™®Îìú ‚Üí ÏàòÏ†ï Î≤ÑÌäº -->
          <button
            v-if="isHR && !isEditing"
            class="btn-save"
            @click="enterEditMode"
          >
            ÏàòÏ†ï
          </button>
          <!-- Ìé∏Ïßë Î™®Îìú ‚Üí Ï∑®ÏÜå / Ï†ÄÏû• Î≤ÑÌäº -->
          <template v-else-if="isHR && isEditing">
            <button class="btn-delete" @click="cancelEdit">
              Ï∑®ÏÜå
            </button>
            <button class="btn-save" @click="saveChanges">
              Ï†ÄÏû•
            </button>
          </template>
        </div>
      </div>
    </template>
  </div>
  <BaseToast ref="toastRef" />
</template>

<script setup>
import { ref, reactive, onMounted, computed, readonly, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import axios from 'axios'
import { useUserStore } from '@/stores/user'
// import { AgGridVue } from 'ag-grid-vue3'
import BaseGrid from '@/components/grid/BaseGrid.vue'
import detailIconUrl from '@/assets/icons/detail_appointment.svg'
import BaseToast from '@/components/toast/BaseToast.vue'
import {
  ModuleRegistry,
  AllCommunityModule,
  ClientSideRowModelModule,
  RowSelectionModule,
  PaginationModule,
  RowAutoHeightModule,
  CellStyleModule,
  ValidationModule
} from 'ag-grid-community'

// ‚Äî Axios Í∏∞Î≥∏ URL
axios.defaults.baseURL = 'http://localhost:5000'

// ‚Äî AG Grid Î™®Îìà Îì±Î°ù
ModuleRegistry.registerModules([
  AllCommunityModule,
  ClientSideRowModelModule,
  RowSelectionModule,
  PaginationModule,
  RowAutoHeightModule,
  CellStyleModule,
  ValidationModule
])

// ‚Äî ÎùºÏö∞ÌÑ∞, Ïä§ÌÜ†Ïñ¥
const route     = useRoute()
const router    = useRouter()
const userStore = useUserStore()
const toastRef = ref(null)

// Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ ÏóêÎü¨ ÏÉÅÌÉú
const errors = reactive({
  contact: '',
  email: '',
  resident: '',
  bankAccount: ''
})





// Ï†ïÍ∑úÏãù Ìå®ÌÑ¥ Ï†ïÏùò
const patterns = {
  contact: /^\d{3}-\d{3,4}-\d{4}$/,
  email:   /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
  resident:/^[0-9]{6}-[1-4][0-9]{6}$/,  // ex. 900101-1234567
  bankAccount: /^[0-9]{6,20}$/          // 6~20ÏûêÎ¶¨ Ïà´Ïûê
}

// Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Ìï®Ïàò
function validate(field, value) {
  if (!value) {
    errors[field] = ''
    return
  }
  
  if (!patterns[field].test(value)) {
    switch (field) {
      case 'contact':
        errors.contact = '010-1234-5678 ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî.'
        break
      case 'email':
        errors.email = 'Ïú†Ìö®Ìïú Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.'
        break
      case 'resident':
        errors.resident = 'Ïòà: 900101-1234567 ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî.'
        break
      case 'bankAccount':
        errors.bankAccount = 'Ïà´ÏûêÎßå, 6~20ÏûêÎ¶¨Î°ú ÏûÖÎ†•ÌïòÏÑ∏Ïöî.'
        break
    }
  } else {
    errors[field] = ''
  }
}

function showToast(msg) {
  toastRef.value?.show(msg)
}

// JWT ÌÜ†ÌÅ∞ ÎîîÏΩîÎî© Ïú†Ìã∏
function parseJwtPayload(token) {
  try {
    const base64Url = token.split('.')[1]
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map(c => `%${('00' + c.charCodeAt(0).toString(16)).slice(-2)}`)
        .join('')
    )
    return JSON.parse(jsonPayload)
  } catch {
    return {}
  }
}

// HR Í∂åÌïú Ïó¨Î∂Ä Í≥ÑÏÇ∞ (role ÌÅ¥Î†àÏûÑÎ™ÖÏùÄ Ïã§Ï†ú JWT Ïóê ÎßûÏ∂∞ Ï°∞Ï†ï)
const isHR = computed(() => {
  const raw = userStore.accessToken?.startsWith('Bearer ')
    ? userStore.accessToken.slice(7)
    : userStore.accessToken
  if (!raw) return false

  const { auth } = parseJwtPayload(raw)
  if (Array.isArray(auth))    return auth.includes('ROLE_HR')
  if (typeof auth === 'string') return auth.includes('ROLE_HR')
  return false
})

// ‚Äî ÌÉ≠ Ï†ïÏùò
const tabs       = ['Ïù∏ÏÇ¨Ï†ïÎ≥¥','Í∞úÏù∏Ï†ïÎ≥¥','Ïù∏ÏÇ¨Î∞úÎ†π','ÏßïÍ≥Ñ','Í≥ÑÏïΩ']
const currentTab = ref(tabs[0])

// ‚Äî AG Grid Í≥µÌÜµ ÏÑ§Ï†ï
const defaultColDef = { sortable: true, filter: true, resizable: true }
const pageSize      = ref(10)
let gridApi         = null
function onGridReady(params) { gridApi = params.api }

// ÎìúÎ°≠Îã§Ïö¥ ÏòµÏÖò Î¶¨Ïä§Ìä∏
const currentYear = new Date().getFullYear()

const yearOptions = Array.from(
  { length: currentYear - 1950 + 1 },
  (_, i) => currentYear - i
)

const workTypeOptions = ['Ï†ïÍ∑úÏßÅ', 'Í≥ÑÏïΩÏßÅ']
const militaryOptions = ['Íµ∞ÌïÑ', 'ÎØ∏ÌïÑ', 'Î≥¥Ï∂©Ïó≠', 'Î©¥Ï†ú', 'Ìï¥Îãπ ÏóÜÏùå']
const genderOptions = ['ÎÇ®', 'Ïó¨']
const insuranceOptions   = ['Í∞ÄÏûÖ','ÎØ∏Í∞ÄÏûÖ']
const disorderOptions    = ['Ïû•Ïï†','ÎπÑÏû•Ïï†']
const marriageOptions    = ['ÎØ∏Ìòº','Í∏∞Ìòº']



// ‚Äî Ïù∏ÏÇ¨Î∞úÎ†π Ïª¨Îüº Ï†ïÏùò
const appointmentColumnDefs = ref([
  // ÏàúÎ≤à
  {
    headerName: 'Î≤àÌò∏',
    width: 90,
    valueGetter: params => params.api.getDisplayedRowCount() - params.node.rowIndex, sortable: false, flex: 0.3, cellClass:'center-align',
    sortable: false,
    suppressMenu: true
  },
  // ÏÇ¨ÏõêÎ≤àÌò∏
  { headerName: 'ÏÇ¨ÏõêÎ≤àÌò∏', field: 'employeeId',             flex: 1 },
  // Î∞úÎ†πÏÇ¨Ïú†
  { headerName: 'Î∞úÎ†πÏÇ¨Ïú†', field: 'appointmentReason',      flex: 1 },
  // Î∞úÎ†πÏú†Ìòï
  { headerName: 'Î∞úÎ†πÏú†Ìòï', field: 'appointmentType',        flex: 1 },
  // Î∞úÎ†πÏùºÏûê
  { headerName: 'Î∞úÎ†πÏùºÏûê', field: 'appointmentEffectiveDate', flex: 1 },
  {
    headerName: 'ÏÉÅÏÑ∏',
    field: 'detail',
    width: 80,
    cellRenderer: () => `<img src="${detailIconUrl}" class="detail-btn"/>`
  }
])

// ‚Äî ÏßïÍ≥Ñ Ïª¨Îüº Ï†ïÏùò
const disciplineColumnDefs = ref([
  {
    headerName: '',
    field: 'checkbox',
    checkboxSelection: true,
    headerCheckboxSelection: true,
    width: 50,
    pinned: 'left'
  },
  { headerName: 'Î≤àÌò∏',            valueGetter: params => params.api.getDisplayedRowCount() - params.node.rowIndex, sortable: false, flex: 0.3, cellClass:'center-align' },
  { headerName: 'ÏÇ¨ÏõêÎ™Ö',          field: 'employeeName',            flex: 1.2 },
  {
    headerName: 'ÏßïÍ≥Ñ ÏÑúÎ•ò',
    field: 'fileList',
    flex: 2,
    cellRenderer: params => {
      const files = Array.isArray(params.value) ? params.value : []
      if (!files.length) return '-'
      const container = document.createElement('div')
      container.className = 'file-list-cell'
      files.forEach((f, i) => {
        const a = document.createElement('a')
        a.href = '#'
        a.textContent = f.fileName
        a.dataset.idx = i
        a.addEventListener('click', async evt => {
          evt.preventDefault()
          // Î∞îÎ°ú Îã§Ïö¥Î°úÎìú Ìò∏Ï∂ú
          await downloadFile(f.fileUrl, f.fileName)
        })
        container.appendChild(a)
      })
      return container
    }
  },
  { headerName: 'ÏßïÍ≥Ñ ÎÇ¥Ïö©',     field: 'disciplinaryDescription', flex: 2 },
  {
    headerName: 'ÏßïÍ≥ÑÏùºÏûê',
    field: 'disciplinaryDate',
    flex: 1,
    cellClass: 'center-align',
    valueFormatter: ({ value }) => new Date(value).toISOString().slice(0,10)
  }
])

// ‚Äî Í≥ÑÏïΩ Ïª¨Îüº Ï†ïÏùò
const contractColumnDefs = ref([
  {
    headerName: '',
    field: 'checkbox',
    checkboxSelection: true,
    headerCheckboxSelection: true,
    width: 50,
    pinned: 'left'
  },
  { headerName: 'Î≤àÌò∏',               valueGetter: params => params.api.getDisplayedRowCount() - params.node.rowIndex, sortable: false, flex: 0.3, cellClass:'center-align' },
  { headerName: 'ÏÇ¨ÏõêÎ™Ö',           field: 'employeeName',        flex: 1.2 },
  { headerName: 'Í≥ÑÏïΩ ÏÑ§Î™Ö',        field: 'contractDescription', flex: 2 },
  {
    headerName: 'ÌååÏùº',
    field: 'fileList',
    flex: 2,
    cellRenderer: params => {
      const files = Array.isArray(params.value) ? params.value : []
      if (!files.length) return '-'

      // Ïª®ÌÖåÏù¥ÎÑà ÏóòÎ¶¨Î®ºÌä∏ ÏÉùÏÑ±
      const container = document.createElement('div')
      container.className = 'file-list-cell'

      files.forEach((f, i) => {
        const a = document.createElement('a')
        a.href = '#'
        a.textContent = f.fileName
        a.dataset.idx = i

        // ÌÅ¥Î¶≠ Ïãú presigned URL Î∞õÏïÑÏÑú Îã§Ïö¥Î°úÎìú
        a.addEventListener('click', async evt => {
          evt.preventDefault()
          try {
            await downloadFile(f.fileUrl, f.fileName)
          } catch (err) {
            console.error('Îã§Ïö¥Î°úÎìú Ïã§Ìå®:', err)
          }
        })

        container.appendChild(a)
      })

      return container
    }
  },
  {
    headerName: 'ÏöîÏ≤≠ÏùºÏûê',
    field: 'requestDate',
    flex: 1,
    cellClass: 'center-align',
    valueFormatter: ({ value }) => new Date(value).toISOString().slice(0,10)
  },
  {
    headerName: 'Í≥ÑÏïΩÏùºÏûê',
    field: 'contractDate',
    flex: 1,
    cellClass: 'center-align',
    valueFormatter: ({ value }) => new Date(value).toISOString().slice(0,10)
  },
  {
    headerName: 'ÎßåÎ£åÏùºÏûê',
    field: 'endDate',
    flex: 1,
    cellClass: 'center-align',
    valueFormatter: ({ value }) => new Date(value).toISOString().slice(0,10)
  }
])

// ‚Äî Í∞Å ÌÉ≠Ïùò rowData
const appointmentData = ref([])
const disciplineData  = ref([])
const contractData    = ref([])

// ‚Äî Ïù∏Ï¶ù Ìó§Îçî Ïú†Ìã∏
function authHeaders() {
  return { Authorization: `Bearer ${userStore.accessToken}` }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ìé∏Ïßë Î™®Îìú ÏÉÅÌÉú ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const isEditing = ref(false)
// Î≥ÄÍ≤Ω Ï†Ñ ÏõêÎ≥∏ Î≥¥Í¥ÄÏö©
let original = {}

// Ìé∏Ïßë Î™®Îìú ÏßÑÏûÖ
function enterEditMode() {
  original = JSON.parse(JSON.stringify(form))
  isEditing.value = true
}

// Ìé∏Ïßë Ï∑®ÏÜå
function cancelEdit() {
  Object.assign(form, original)
  isEditing.value = false
}

async function saveChanges() {
  const requiredChecks = [
    { key: 'employeePhotoUrl',   msg: 'ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeName',       msg: 'ÏÇ¨ÏõêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employmentDate',     msg: 'ÏûÖÏÇ¨ÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeNation',     msg: 'Íµ≠Ï†ÅÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeGender',     msg: 'ÏÑ±Î≥ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeBirth',      msg: 'ÏÉùÎÖÑÏõîÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeResident',   msg: 'Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeContact',    msg: 'Ïó∞ÎùΩÏ≤òÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeEmail',      msg: 'Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeAddress',    msg: 'Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'workType',           msg: 'Í∑ºÎ¨¥ÌòïÌÉúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'bankName',           msg: 'ÏùÄÌñâÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'bankDepositor',      msg: 'ÏòàÍ∏àÏ£ºÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'bankAccount',        msg: 'Í≥ÑÏ¢åÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'isDisorder',         msg: 'Ïû•Ïï†Ïó¨Î∂ÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'militaryType',       msg: 'Î≥ëÏó≠Ïó¨Î∂ÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'isMarriage',         msg: 'Í≤∞ÌòºÏó¨Î∂ÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'familyCount',        msg: 'Í∞ÄÏ°± ÏàòÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'finalAcademic',      msg: 'ÏµúÏ¢Ö ÌïôÎ†•ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'employeeSchool',     msg: 'ÏµúÏ¢Ö ÌïôÍµêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' },
    { key: 'isFourInsurances',   msg: '4ÎåÄ Î≥¥Ìóò Ïó¨Î∂ÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.' },
  ];

  for (const { key, msg } of requiredChecks) {
    const val = form[key];
    if (val === '' || val === null || val === undefined) {
      return showToast(msg);
    }
  }

  // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ ÏóêÎü¨ ÌôïÏù∏
  const hasValidationErrors = Object.values(errors).some(error => error !== '')
  if (hasValidationErrors) {
    return showToast('ÏûÖÎ†• ÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.')
  }

  // HR Ï†ÑÏö© DTO
  const hrDto = {
    employeeName:      form.employeeName,
    employeePhotoName: form.employeePhotoName,
    employeePhotoUrl:  form.employeePhotoUrl,
    employeeNation:    form.employeeNation,
    employeeGender:    form.employeeGender,
    employeeBirth:     form.employeeBirth,
    employeeResident:  form.employeeResident,
    employeeContact:   form.employeeContact,
    employeeEmail:     form.employeeEmail,
    employeeAddress:   form.employeeAddress,
    employmentDate:    form.employmentDate,
    retirementDate:    form.retirementDate,
    workType:          form.workType,
    bankName:          form.bankName,
    bankDepositor:     form.bankDepositor,
    bankAccount:       form.bankAccount,
    isDisorder:        form.isDisorder,
    militaryType:      form.militaryType,
    isMarriage:        form.isMarriage,
    marriageDate:      form.marriageDate,
    familyCount:       form.familyCount,
    careerYearCount:   form.careerYearCount,
    previousCompany:   form.previousCompany,
    finalAcademic:     form.finalAcademic,
    employeeSchool:    form.employeeSchool,
    employeeDept:      form.employeeDept,
    graduationYear:    form.graduationYear,
    isFourInsurances:  form.isFourInsurances,
    positionId:        form.positionId,
    rankId:            form.rankId,
    jobId:             form.jobId,
    headId:            form.headId,
    departmentId:      form.departmentId,
    teamId:            form.teamId,
  };

  try {
    // Î¨¥Ï°∞Í±¥ HR Ï†ÑÏö© PUT Ìò∏Ï∂ú
    await axios.put(
      `/employees/${form.employeeId}`,
      hrDto,
      { headers: authHeaders() }
    );
    showToast('ÏàòÏ†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
    isEditing.value = false;
  } catch (err) {
    console.error(err);
    showToast('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
  }
}

async function downloadFile(fileUrl, fileName) {
  try {
    const { data: presignedUrl } = await axios.get(
      '/s3/download-url',
      {
        params: { filename: fileUrl, contentType: '' },
        headers: authHeaders()
      }
    )
    const res  = await fetch(presignedUrl)
    const blob = await res.blob()
    const url  = URL.createObjectURL(blob)
    const a    = document.createElement('a')
    a.href     = url
    a.download = fileName
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
  } catch (err) {
    console.error('ÌååÏùº Îã§Ïö¥Î°úÎìú Ïã§Ìå®:', err)
    showToast('ÌååÏùº Îã§Ïö¥Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')
  }
}

async function onCellClick(e) {
  // 1) ÏÉÅÏÑ∏ Î≤ÑÌäº ÌÅ¥Î¶≠
  if (e.colDef.field === 'detail') {
    router.push(`/org/appointment/${e.data.appointmentHistoryId}`)
    return
  }

  // 2) ÌååÏùº Î™©Î°ù ÌÅ¥Î¶≠ Ïãú Îã§Ïö¥Î°úÎìú
  if (
    e.colDef.field === 'fileList' &&
    e.event.target.matches('a') &&
    e.event.target.dataset.idx != null
  ) {
    e.event.preventDefault()
    const idx  = Number(e.event.target.dataset.idx)
    const file = (e.data.fileList || [])[idx]
    if (!file) return
    await downloadFile(file.fileUrl, file.fileName)
  }
}

// ‚Äî ÏÇ¨Ïõê Í∏∞Î≥∏ Ï†ïÎ≥¥ Ìèº
const form = reactive({
  employeeId:        '',
  employeeName:      '',
  employeePhotoName: '',
  employeePhotoUrl:  '',
  jobName:           '',
  workType:          '',
  headName:          '',
  positionName:      '',
  employmentDate:    '',
  departmentName:    '',
  rankName:          '',
  retirementDate:    '',
  teamName:          '',
  employeeContact:   '',
  employeeEmail:     '',
  employeeNation:    '',
  employeeGender:    '',
  employeeBirth:     '',
  employeeResident:  '',
  employeeAddress:   '',
  isFourInsurances:  '',
  bankName:          '',
  bankDepositor:     '',
  bankAccount:       '',
  isDisorder:        '',
  militaryType:      '',
  isMarriage:        '',
  marriageDate:      '',
  familyCount:       '',
  careerYearCount:   '',
  previousCompany:   '',
  finalAcademic:     '',
  employeeSchool:    '',
  employeeDept:      '',
  graduationYear:    '',
  positionId:       '',
  rankId:           '',
  jobId:            '',
  headId:           '',
  departmentId:     '',
  teamId:           ''
})

// watchÎ°ú Ïã§ÏãúÍ∞Ñ Í≤ÄÏÇ¨
watch(() => form.employeeContact, v => validate('contact', v))
watch(() => form.employeeEmail,   v => validate('email',   v))
watch(() => form.employeeResident, v => validate('resident', v))
watch(() => form.bankAccount,     v => validate('bankAccount', v))

// ‚Äî Îí§Î°úÍ∞ÄÍ∏∞
function goBack() {
  router.back()
}

// ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ URL
const previewSrc = ref('')      
// Ïà®Í≤®ÏßÑ file input Î†àÌçºÎü∞Ïä§
const fileInput  = ref(null)

// ÌååÏùº ÏÑ†ÌÉùÏ∞Ω Ïó¥Í∏∞
function triggerFileSelect() {
  fileInput.value.click()
}

// ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêêÏùÑ Îïå Ïã§Ìñâ
async function onPhotoSelected(e) {
  const file = e.target.files?.[0]
  if (!file) return

  // presigned ÏóÖÎ°úÎìú URL + key ÏñªÍ∏∞
  const { data: { url, key } } = await axios.get('/s3/upload-url', {
    params: { filename: file.name, contentType: file.type },
    headers: authHeaders()
  })
  // ÌååÏùº PUT
  await axios.put(url, file, { headers: { 'Content-Type': file.type } })

  // form ÏóêÎäî keyÎßå
  form.employeePhotoUrl  = key
  form.employeePhotoName = file.name

  // ÎØ∏Î¶¨Î≥¥Í∏∞ URLÏùÄ Î≥ÑÎèÑ Î≥ÄÏàòÏóê
  const { data: previewUrl } = await axios.get('/s3/download-url', {
    params: { filename: key, contentType: file.type },
    headers: authHeaders()
  })
  previewSrc.value = previewUrl
}

onMounted(async () => {
  const { id } = route.params;

  // 1) ÏÇ¨Ïõê Í∏∞Î≥∏ Ï†ïÎ≥¥ Ï°∞Ìöå
  try {
    const { data: emp } = await axios.get(
      `/employees/${id}`,
      { headers: authHeaders() }
    );

    // ‚ñº empÏùò Î™®Îì† ÌïÑÎìúÎ•º formÏóê ÏßÅÏ†ë Ìï†Îãπ
    Object.assign(form, {
      employeeId:        emp.employeeId,
      employeeName:      emp.employeeName,
      employeePhotoName: emp.employeePhotoName,
      employeePhotoUrl:  emp.employeePhotoUrl,
      jobName:           emp.jobName,
      workType:          emp.workType,
      headName:          emp.headName,
      positionName:      emp.positionName,
      employmentDate:    emp.employmentDate,
      departmentName:    emp.departmentName,
      rankName:          emp.rankName,
      retirementDate:    emp.retirementDate,
      teamName:          emp.teamName,
      employeeContact:   emp.employeeContact,
      employeeEmail:     emp.employeeEmail,
      employeeNation:    emp.employeeNation,
      employeeGender:    emp.employeeGender,
      employeeBirth:     emp.employeeBirth,
      employeeResident:  emp.employeeResident,
      employeeAddress:   emp.employeeAddress,
      isFourInsurances:  emp.isFourInsurances,
      bankName:          emp.bankName,
      bankDepositor:     emp.bankDepositor,
      bankAccount:       emp.bankAccount,
      isDisorder:        emp.isDisorder,
      militaryType:      emp.militaryType,
      isMarriage:        emp.isMarriage,
      marriageDate:      emp.marriageDate,
      familyCount:       emp.familyCount,
      careerYearCount:   emp.careerYearCount,
      previousCompany:   emp.previousCompany,
      finalAcademic:     emp.finalAcademic,
      employeeSchool:    emp.employeeSchool,
      employeeDept:      emp.employeeDept,
      graduationYear:    emp.graduationYear,

      // ‚Äî DBÏóêÏÑú ÎÇ¥Î†§Ï£ºÎäî IDÎ•º Í∑∏ÎåÄÎ°ú Ìï†Îãπ
      positionId:       emp.positionId,
      rankId:           emp.rankId,
      jobId:            emp.jobId,
      headId:           emp.headId,
      departmentId:     emp.departmentId,
      teamId:           emp.teamId
    });

    // ‚ñº ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ preview ÏÑ∏ÌåÖ
    if (emp.employeePhotoUrl) {
      try {
        const { data: url } = await axios.get(
          '/s3/download-url',
          {
            params: {
              filename:    emp.employeePhotoUrl,
              contentType: 'image/png'
            },
            headers: authHeaders()
          }
        );
        previewSrc.value = url;
      } catch {
        previewSrc.value = '';
      }
    } else {
      previewSrc.value = '';
    }

  } catch (err) {
    console.error(err);
    showToast('ÏÇ¨Ïõê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
    router.back();
    return;
  }

  // 2) Ïù∏ÏÇ¨Î∞úÎ†π Î™©Î°ù Ï°∞Ìöå
  try {
    const { data: appts } = await axios.get(
      `/appointment-history/employee/${id}`,
      { headers: authHeaders() }
    );
    appointmentData.value = appts;
  } catch (err) {
    console.error('Ïù∏ÏÇ¨Î∞úÎ†π Ï°∞Ìöå Ïã§Ìå®:', err);
  }

  // 3) ÏßïÍ≥Ñ Î™©Î°ù Ï°∞Ìöå
  try {
    const { data: discs } = await axios.get(
      `/disciplinary/employee/${id}`,
      { headers: authHeaders() }
    );
    disciplineData.value = discs;
  } catch (err) {
    console.error('ÏßïÍ≥Ñ Ï°∞Ìöå Ïã§Ìå®:', err);
  }

  // 4) Í≥ÑÏïΩ Î™©Î°ù Ï°∞Ìöå
  try {
    const { data: contracts } = await axios.get(
      `/contract/employee/${id}`,
      { headers: authHeaders() }
    );
    contractData.value = contracts;
  } catch (err) {
    console.error('Í≥ÑÏïΩ Ï°∞Ìöå Ïã§Ìå®:', err);
  }
});

</script>

<style scoped>
/* ÌéòÏù¥ÏßÄ ÌÉÄÏù¥ÌãÄÍ≥º ÏÑ§Î™Ö */
.page-title {
  margin-left: 20px;
  margin-bottom: 30px;
  color: var(--primary);
}

/* "ÏÇ¨Ïõê ÏÉÅÏÑ∏ Ï°∞Ìöå" ÌÖçÏä§Ìä∏ÏôÄ Î≤ÑÌäºÏùÑ Í∞ôÏùÄ ÌñâÏóê Î∞∞Ïπò */
.desc-row {
  display: flex;
  align-items: center;   /* ÌÖçÏä§Ìä∏ÏôÄ Î≤ÑÌäºÏùÑ ÏàòÏßÅ Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */
  margin-left: 20px;     /* Í∏∞Ï°¥ .desc Ïùò margin-left */
}
.desc {
  margin: 0;
  font-size: 18px;
}

/* Í∏∞Î≥∏Ïóî Ïà®ÍπÄ */
.required-star {
  display: none;
  color: red;
}
/* ÏàòÏ†ï Î™®ÎìúÏùº ÎïåÎßå ÌëúÏãú */
.editing-mode .required-star {
  display: inline;
}

.back-btn {
  color: var(--primary);
  width: 24px;
  height: 24px;
  margin-right: -10px;
  cursor: pointer;
}

.btn-save {
  background-color: var(--primary);
  color: var(--text-on-primary);
  font-weight: bold;
  border: 1px solid transparent;
  border-radius: 10px;
  padding: 10px 30px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: background-color 0.2s, box-shadow 0.2s;
  box-sizing: border-box;
}
.btn-save:hover {
  background-color: var(--bg-main);
  color: var(--primary);
  border-color: var(--primary);
  box-shadow: inset 1px 1px 10px rgba(0, 0, 0, 0.25);
}

.btn-delete {
  background-color: #d3d3d3;
  color: #000;
  border: none;
  border-radius: 10px;
  padding: 10px 30px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: background-color 0.2s, box-shadow 0.2s;
  box-sizing: border-box;
}
.btn-delete:hover {
  background-color: #000;
  color: #fff;
}

/* EmployeeDetail Ï†ÑÏ≤¥ Ïª®ÌÖåÏù¥ÎÑà */
.employee-detail {
  margin: 10px 20px 0;
  font-size: 14px;
  max-width: 100%;
  overflow-x: hidden; 
}

/* Í≥µÌÜµ Card Ïä§ÌÉÄÏùº (ÏÉÅÎã®/ÌïòÎã® Î™®Îëê ÎèôÏùº) */
.card {
  background: var(--bg-box);
  border-radius: 12px;
  box-shadow: 1px 1px 20px 1px rgba(0, 0, 0, 0.05);
  width: 100%;
  min-width: 0;
  max-width: 100%;
  margin-bottom: 30px;
  padding: 20px 40px 32px 40px;
  box-sizing: border-box;
}

/* ÌïòÎã® Ïπ¥ÎìúÏóê ÏÉÅÎåÄ ÏúÑÏπò ÏÑ§Ï†ï */
.bottom-card {
  position: relative;
  min-height: 200px; /* ÏµúÏÜå ÎÜíÏù¥ ÏÑ§Ï†ïÏúºÎ°ú Î≤ÑÌäºÏù¥ Ìï≠ÏÉÅ Î≥¥Ïù¥ÎèÑÎ°ù */
  padding-bottom: 80px; /* Î≤ÑÌäº Í≥µÍ∞Ñ ÌôïÎ≥¥ */
  border-radius: 0px 12px 12px 12px; /* ÏÉàÎ°úÏö¥ ÌÉ≠ ÎîîÏûêÏù∏Ïóê ÎßûÏ∂∞ Ï°∞Ï†ï */
}

/* ÌÉ≠ ÏΩòÌÖêÏ∏† ÎûòÌçº */
.tab-content-wrapper {
  width: 100%;
  height: 100%;
}

/* ÏÉÅÎã® Ïπ¥Îìú ÎÇ¥Î∂Ä Î†àÏù¥ÏïÑÏõÉ */
.top-card-layout {
  display: flex;
  gap: 2rem;
  align-items: flex-start;
  min-width: 1024px;
  padding: 16px 6px;
}

/* ÌîÑÎ°úÌïÑ */
.profile-area {
  flex-shrink: 0;
}
.profile-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 6px;
}
.profile-img {
  width: 200px;
  height: 260px;
  object-fit: cover;
  border-radius: 12px;
}

/* ÏÇ¨ÏßÑÏù¥ ÏóÜÏùÑ Îïå ÌëúÏãúÎêòÎäî Î∞ïÏä§ Î∞è ÌÖçÏä§Ìä∏ */
.profile-placeholder-box {
  width: 200px;
  height: 260px;
  border: 1px dashed #ccc;
  border-radius: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #fafafa;
}
.no-photo-text {
  color: #999;
  font-size: 14px;
}

/* ÏóÖÎ°úÎìú Î≤ÑÌäº ÏïÑÏù¥ÏΩò (ÌöåÏÉâ Ïõê ÏóÜÏù¥) */
.upload-btn-icon {
  position: absolute;
  right: -40px;
  bottom: -10px;
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  z-index: 1;
}
.upload-icon {
  width: 40px;
  height: 40px;
}
.upload-btn-icon:hover .upload-icon {
  filter: invert(41%) sepia(50%) saturate(6012%) hue-rotate(173deg) brightness(90%) contrast(98%);
}

/* Ïï°ÏÖò Î≤ÑÌäºÏùÑ ÌïòÎã® Ïπ¥ÎìúÏùò Ïò§Î•∏Ï™Ω ÌïòÎã®Ïóê Í≥†Ï†ï */
.action-buttons-bottom {
  position: absolute;
  bottom: 20px;
  right: 40px;
  display: flex;
  gap: 8px;
  z-index: 10;
}

/* üî∑ ÏÉàÎ°úÏö¥ Í≤πÏ≥êÏßÄÎäî ÌÉ≠ Ïä§ÌÉÄÏùº */
.tab-wrapper {
  position: relative;
  z-index: 2;
  margin-top: 15px;
}

.tab-menu {
  display: flex;
  align-items: flex-end;
  gap: 0;
  position: relative;
}

/* Í∏∞Î≥∏ ÌÉ≠ Î≤ÑÌäº */
.tab-menu button {
  font-size: 16px;
  padding: 10px 30px;
  border: none;
  border-bottom: none;
  background-color: #C8C8C8;
  color: white;
  cursor: pointer;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  position: relative;
  z-index: 1;
  margin-right: -20px; /* ‚úÖ Í∞ÄÎ°ú Í≤πÏπòÍ∏∞ */
  transition: all 0.2s ease;
}

/* ÏÑ†ÌÉùÎêú ÌÉ≠ ÏúÑÎ°ú */
.tab-menu button.active {
  background: var(--bg-box);
  color: var(--modal-text);
  z-index: 3;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   ÏúÑÏ™Ω Ïπ¥Îìú Ï†ÑÏö© Í∑∏Î¶¨Îìú (3Ïó¥ √ó 5Ìñâ)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.top-grid-info {
  display: grid;
  grid-template-columns: repeat(3, minmax(200px, 1fr));
  gap: 1.5rem;
  width: 100%;
  box-sizing: border-box;
}

/* ÏïÑÎûòÏ™Ω Ïπ¥Îìú Í∑∏Î¶¨Îìú (ÏõêÎ≥∏ Í∑∏ÎåÄÎ°ú) */
.grid-info {
  display: grid;
  grid-template-columns: repeat(3, minmax(300px, 1fr));
  gap: 2rem;
  width: 100%;
  box-sizing: border-box;
  flex-wrap: wrap;
}
@media (max-width: 1024px) {
  .grid-info {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    white-space: normal;
  }
}

.grid-info,
.ag-grid-box {
  margin-bottom: 24px;    /* ÏõêÌïòÎäî Í∞ÑÍ≤©ÏúºÎ°ú Ï°∞Ï†à */
}

/* AG Grid Ïª®ÌÖåÏù¥ÎÑà */
.ag-grid-box {
  width: 100%;
  height: 300px;
  /* border: 1px solid #d9d9d9; */
  border-radius: 8px;
  overflow: hidden;
  margin: 0 auto;
  overflow-y: auto;
}

.info-column {
  display: contents;
}
.info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  margin-bottom: 8px;
}
.label-bold {
  font-weight: 600;
  width: 100px;
  text-align: right;
}
.same-size-input {
  width: 180px;
  height: 36px;
  padding: 0 0.6rem;
  font-size: 0.9rem;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-sizing: border-box;
  background-color: var(--modal-box-bg) !important;
  color: var(--text-main);
  font-family: 'inherit';
}

/* ÏÖÄ Ï§ëÏïô Ï†ïÎ†¨ */
.center-align {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.modal-content {
  background: #ffffff;
  border-radius: 12px;
  padding: 30px 40px;
  width: 400px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  text-align: center;
}
.modal-content p {
  margin-bottom: 16px;
  font-size: 18px;
}
.modal-buttons {
  display: flex;
  justify-content: space-between;
}
.btn-modal {
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  font-weight: bold;
  cursor: pointer;
}
.btn-cancel {
  background-color: #d3d3d3;
  color: #000;
  flex: 1;
  margin-right: 10px;
}
.btn-cancel:hover {
  background-color: #000;
  color: #fff;
}
.btn-confirm {
  background-color: var(--primary);
  color: white;
  flex: 1;
}
.btn-confirm:hover {
  background-color: white;
  color: var(--primary);
  border: 1px solid var(--primary);
}

input[readonly] {
  background-color: #f9f9f9;
  border: none;
}

:deep(.file-list-cell) {
  display: flex;
  flex-wrap: nowrap;
  /* ÎßÅÌÅ¨Îì§ ÏÇ¨Ïù¥ Í∞ÑÍ≤©ÏùÑ 8pxÎ°ú ÏÑ§Ï†ï */
  gap: 8px;
  max-height: 36px;
  padding-right: 8px;
}
/* a ÌÉúÍ∑∏Îäî Ï§ÑÎ∞îÍøà ÏóÜÏù¥ */
.file-list-cell a {
  white-space: nowrap;
  text-decoration: underline;
  cursor: pointer;
}

.detail-btn {
  background: none;
  border: none;
  padding: 4px;
  cursor: pointer;
  width: 30px;
  height: 30px;
}

.error-text {
  position: absolute;
  top: 0;
  left: 300px;
  color: #e74c3c;
  font-size: 0.8rem;
  z-index: 10;
  white-space: nowrap;  /* ÌÖçÏä§Ìä∏ Ï§ÑÎ∞îÍøà Î∞©ÏßÄ */
  min-width: max-content;  /* ÎÇ¥Ïö©Ïóê ÎßûÎäî ÏµúÏÜå ÎÑàÎπÑ */
  overflow: visible;  /* ÎÑòÏπòÎäî ÌÖçÏä§Ìä∏ ÌëúÏãú */
}

/* Î∞òÏùëÌòï ÎåÄÏùë */
@media (max-width: 768px) {
  .action-buttons-bottom {
    bottom: 15px;
    right: 20px;
  }

  .bottom-card {
    padding-bottom: 70px;
  }
}
</style>